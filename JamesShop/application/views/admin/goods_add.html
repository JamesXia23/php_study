<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<title></title>
	<link href="application/views/admin/styles/general.css" rel="stylesheet" type="text/css" />
	<link href="application/views/admin/styles/main.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="application/views/admin/js/utils.js"></script>
	<script type="text/javascript" src="application/views/admin/js/selectzone.js"></script>
	<script type="text/javascript" src="application/views/admin/js/colorselector.js"></script>
	<script type="text/javascript" src="application/views/admin/js/calendar.php?lang="></script>
</head>
<body>
<h1>
	<span class="action-span"><a href="index.php?p=admin&c=goods&a=index">商品列表</a></span>
	<span class="action-span1"><a href="index.php?p=admin" target="_parent">SHOP 管理中心 </a> </span><span id="search_id" class="action-span1"> - 编辑商品信息 </span>
	<div style="clear:both"></div>
</h1>

<div class="tab-div">
    <!-- tab bar -->
    <div id="tabbar-div">
      <p>
        <span class="tab-front" id="general-tab">通用信息</span>
		<span class="tab-back" id="detail-tab">详细描述</span>
		<span class="tab-back" id="mix-tab">其他信息</span>
		<span class="tab-back" id="properties-tab">商品属性</span>
		<span class="tab-back" id="gallery-tab">商品相册</span>
      </p>
    </div>

    <!-- tab body -->
    <div id="tabbody-div">
      <form enctype="multipart/form-data" action="index.php?p=admin&c=goods&a=insert" method="post" name="theForm">
        <input type="hidden" name="MAX_FILE_SIZE" value="2097152">
		 
		 <!-- 通用信息 -->
        <table width="90%" id="general-table" align="center" style="display: table;">
            <tr>
                <td class="label">商品名称：</td>
                <td>
                    <input type="text" name="goods_name" value="" size="30">
                    <span class="require-field">*</span>
                </td>
            </tr>
            <tr>
                <td class="label">商品分类：</td>
                <td>
                    <select name="cat_id" onchange="hideCatDiv()">
                        <option value="0">请选择...</option>
                        <?php foreach ($cats as $cat) :?>
                        <option value="<?php echo $cat['cat_id'];?>">
                            <?php echo str_repeat("&nbsp;&nbsp;", $cat['level']);?>
                            <?php echo $cat['cat_name'];?>
                        </option>
                        <?php endforeach;?>
                    </select>
                 </td>
            </tr>
            <tr>
				<td class="label">本店售价：</td>
				<td><input type="text" name="shop_price" value="" size="20" onblur="priceSetted()">
				<span class="require-field">*</span></td>
			</tr>

            <tr>
                <td class="label">市场售价：</td>
                <td><input type="text" name="market_price" value="" size="20"></td>
            </tr>
            <tr>
                <td class="label">
                    <label for="is_promote">
                        <input type="checkbox" id="is_promote" name="is_promote" value="1">
                        促销价：
                    </label>
                </td>
                <td id="promote_3">
                    <input type="text" id="promote_1" name="promote_price" size="20">
                </td>
            </tr>
            <tr id="promote_4">
                <td class="label" id="promote_5">促销日期：</td>
                <td id="promote_6">
                    <input name="promote_start_time" type="text" id="promote_start_date" size="12">
                    <input name="promote_end_time" type="text" id="promote_end_date" size="12">
                </td>
            </tr>
            <tr>
                <td class="label">上传商品图片：</td>
                <td>
                  <input type="file" name="goods_img" size="35">
                </td>
            </tr>
        </table>

        <!-- 详细描述 -->
        <table width="90%" id="detail-table" style="display: none;">
          <tbody>
          <tr>
            <td>
                <input type="hidden" id="goods_desc" name="goods_desc" value="" style="display:none">
                <input type="hidden" id="goods_desc___Config" value="" style="display:none">
                <iframe id="goods_desc___Frame"
                        src="application/views/admin/fckeditor/editor/fckeditor.html?InstanceName=goods_desc&amp;Toolbar=Normal"
                        width="100%" height="320" frameborder="0" scrolling="no"
                        style="margin: 0px; padding: 0px; border: 0px; background-color: transparent; background-image: none; width: 100%; height: 320px;">
                </iframe>
            </td>
          </tr>
          </tbody>
        </table>

        <!-- 其他信息 -->
        <table width="90%" id="mix-table" style="display: none;" align="center">
            <tbody>
            <tr>
                <td class="label">
                    <a href="javascript:showNotice('noticeStorage');" title="点击此处查看提示信息">
                    <img src="application/views/admin/images/notice.gif" width="16" height="16" border="0" alt="点击此处查看提示信息">
                    </a>
                    商品库存数量：
                </td>
    <!--            <td><input type="text" name="goods_number" value="4" size="20" readonly="readonly" /><br />-->
                <td><input type="text" name="goods_number" size="20">
            </tr>
            <tr>
                <td class="label">加入推荐：</td>
                <td>
                    <input type="checkbox" name="is_best" value="1">精品
                    <input type="checkbox" name="is_new" value="1">新品
                    <input type="checkbox" name="is_hot" value="1">热销
                </td>
            </tr>
            <tr id="alone_sale_1">
                <td class="label" id="alone_sale_2">上架：</td>
                <td id="alone_sale_3">
                    <input type="checkbox" name="is_onsale" value="1" checked="checked">
                    打勾表示允许销售，否则不允许销售。
                </td>
            </tr>
          <tr>
            <td class="label">商品简单描述：</td>
            <td><textarea name="goods_brief" cols="40" rows="3"></textarea></td>
          </tr>
            </tbody>
        </table>

        <!-- 商品属性 -->
         <table width="90%" id="properties-table" style="display: none;" align="center">
			<tbody>
				<tr>
					<td class="label">商品类型：</td>
					<td>
						<select name="type_id" onchange="getAttrList(this.value)"><!--当选择一改变就局部刷新-->
							<option value="0">请选择商品类型</option>
							<?php foreach ($types as $type):?>
							<option value="<?php echo $type['type_id'];?>"><?php echo $type['type_name'];?></option>
							<?php endforeach;?>
						</select><br>
						<span class="notice-span" style="display:block" id="noticeGoodsType">请选择商品的所属类型，进而完善此商品的属性</span>
					</td>
				</tr>
				<tr>
				<td id="tbody-goodsAttr" colspan="2" style="padding:0">

				</td>
			 </tr>
            </tbody>
         </table>
        
        <!-- 商品相册 -->
        <table width="90%" id="gallery-table" style="display: none;" align="center">
          <tbody>
          <tr>
            <td>
              <a href="javascript:;" onclick="addImg(this)">[+]</a>
              图片描述 <input type="text" name="img_desc[]" size="20">
              上传文件 <input type="file" name="img_url[]" multiple >
              <!--<input type="text" size="40" value="或者输入外部图片链接地址" style="color:#aaa;" onfocus="if (this.value == '或者输入外部图片链接地址'){this.value='http://';this.style.color='#000';}" name="img_file[]">-->
            </td>
          </tr>
          </tbody>
        </table>

        <div class="button-div">
          <input type="hidden" name="goods_id" value="32">
                    <input type="submit" value=" 确定 " class="button">
          <input type="reset" value=" 重置 " class="button">
        </div>
        <input type="hidden" name="act" value="update">
      </form>
    </div>
</div>

<iframe src="" frameborder="0" width="0" height="0" id="ifr"></iframe>

<?php include 'footer.html';?>

<script type="text/javascript" src="application/views/admin/js/tab.js"></script>
<script type="text/javascript">
	function addImg(obj){
      var src  = obj.parentNode.parentNode;
      var idx  = rowindex(src);
      var tbl  = document.getElementById('gallery-table');
      var row  = tbl.insertRow(idx + 1);
      var cell = row.insertCell(-1);
      cell.innerHTML = src.cells[0].innerHTML.replace(/(.*)(addImg)(.*)(\[)(\+)/i, "$1removeImg$3$4-");
  	}

    function removeImg(obj){
      var row = rowindex(obj.parentNode.parentNode);
      var tbl = document.getElementById('gallery-table');
      tbl.deleteRow(row);
  	}

   	function dropImg(imgId){
    	Ajax.call('goods.php?is_ajax=1&act=drop_image', "img_id="+imgId, dropImgResponse, "GET", "JSON");
  	}

  	function dropImgResponse(result){
      if (result.error == 0){
          document.getElementById('gallery_' + result.content).style.display = 'none';
      }
  	}

	//增加一个属性行
	function addSpec(obj) {
      var src   = obj.parentNode.parentNode;
      var idx   = rowindex(src);
      var tbl   = document.getElementById('attrTable');
      var row   = tbl.insertRow(idx + 1);
      var cell1 = row.insertCell(-1);
      var cell2 = row.insertCell(-1);
      var regx  = /<a([^>]+)<\/a>/i;

      cell1.className = 'label';
      cell1.innerHTML = src.childNodes[0].innerHTML.replace(/(.*)(addSpec)(.*)(\[)(\+)/i, "$1removeSpec$3$4-");
      cell2.innerHTML = src.childNodes[1].innerHTML.replace(/readOnly([^\s|>]*)/i, '');
  }

  /**
   * 删除一个属性行
   */
  function removeSpec(obj) {
      var row = rowindex(obj.parentNode.parentNode);
      var tbl = document.getElementById('attrTable');

      tbl.deleteRow(row);
  }

  /**
   * 处理
   */
  function handleSpec() {
      var elementCount = document.forms['theForm'].elements.length;
      for (var i = 0; i < elementCount; i++)
      {
          var element = document.forms['theForm'].elements[i];
          if (element.id.substr(0, 5) == 'spec_')
          {
              var optCount = element.options.length;
              var value = new Array(optCount);
              for (var j = 0; j < optCount; j++)
              {
                  value[j] = element.options[j].value;
              }

              var hiddenSpec = document.getElementById('hidden_' + element.id);
              hiddenSpec.value = value.join(String.fromCharCode(13));
          }
      }
      return true;
  }

  function getAttrList(type_id) {
  	var ifr = document.getElementById('ifr');
  	ifr.src = "index.php?p=admin&c=attribute&a=getAttrs&type_id="+type_id;//调用attribute控制器的方法来获取属性
  }
</script>
</body>
</html>